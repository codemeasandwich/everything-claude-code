---
allowed-tools: Bash(npm:*), Bash(bun:*), Bash(pytest:*), Bash(make:*)
description: Run tests - MUST achieve 100% coverage
---

## Context

- Package scripts: !`cat package.json 2>/dev/null | grep -A 20 '"scripts"' | head -25`
- Python config: !`cat pyproject.toml 2>/dev/null | head -30`

## Testing Philosophy

**100% coverage is MANDATORY.** All metrics must reach 100%:
- Statements
- Branches
- Functions
- Lines

**Zero unit tests.** Every test simulates what a real user or developer would do.

If coverage < 100%:
1. Identify uncovered code paths
2. Ask: "What would a user/developer do to trigger this code?"
3. If reachable via user action → Write E2E test for that scenario
4. If unreachable via any user action → Comment out as dead code

## Instructions

1. **Run tests with coverage:**
   - npm project with `test:cover`: `npm run test:cover`
   - npm project with `test`: `npm test -- --coverage`
   - Python: `pytest --cov --cov-report=term-missing --cov-fail-under=100`
   - Bun: `bun test --coverage`

2. **Parse coverage output and identify gaps:**
   - List files below 100%
   - Identify specific uncovered lines/branches

3. **For each uncovered code path:**
   - Determine the user scenario that would trigger it
   - Plan the E2E test that exercises that path
   - Implement the test
   - Re-run coverage to verify

4. **ITERATE until 100%:**
   - Do NOT stop before achieving 100% on all metrics
   - After each change, re-run coverage
   - Report progress after each iteration

5. **If code is truly unreachable:**
   - Mark it as dead code
   - Comment it out with explanation
   - This allows coverage to reach 100%

## Output Format

After each iteration report:
```
Coverage: X% statements, X% branches, X% functions, X% lines

Gaps:
- file.js:42-45 - branch in errorHandler not covered
  → User scenario: Send malformed request to trigger error
  → Adding test...

[or]
- file.js:100-105 - internal validation never reachable
  → Marking as dead code (commenting out)
```

Final report:
```
SUCCESS: 100% coverage achieved
- Statements: 100%
- Branches: 100%
- Functions: 100%
- Lines: 100%
```
